version: 2
jobs:
  build:
    environment:
      ACCOUNT: circleci@yyyy-stg.iam.gserviceaccount.com
      GAE_GO_SDK_VERSION: 1.9.24
      PATH: $PATH:$HOME/go_appengine
    docker:
      - image: google/cloud-sdk:171.0.0-alpine
    steps:
      - checkout
      - run: echo "A first hello"
      - run: touch ~/.ssh/portfolio
      - run: echo $PRIVATE_KEY | base64 --decode --ignore-garbage > ~/.ssh/portfolio
      - run: chmod 400 ~/.ssh/portfolio
      - run: pyenv global 2.7.12
      - run: ssh $DOMAIN -i ~/.ssh/portfolio 'export PATH=$HOME/.rbenv/bin:$PATH; eval "$(rbenv init -)";sh /home/dracrowa/portfolio-desu/build.sh'